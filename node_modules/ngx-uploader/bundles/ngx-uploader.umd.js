!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("@angular/core"),require("rxjs/Observable"),require("rxjs/add/observable/of"),require("rxjs/add/observable/from"),require("rxjs/add/operator/mergeMap"),require("rxjs/add/operator/map")):"function"==typeof define&&define.amd?define("ngx-uploader",["@angular/core","rxjs/Observable","rxjs/add/observable/of","rxjs/add/observable/from","rxjs/add/operator/mergeMap","rxjs/add/operator/map"],t):"object"==typeof exports?exports["ngx-uploader"]=t(require("@angular/core"),require("rxjs/Observable"),require("rxjs/add/observable/of"),require("rxjs/add/observable/from"),require("rxjs/add/operator/mergeMap"),require("rxjs/add/operator/map")):e["ngx-uploader"]=t(e["@angular/core"],e["rxjs/Observable"],e["rxjs/add/observable/of"],e["rxjs/add/observable/from"],e["rxjs/add/operator/mergeMap"],e["rxjs/add/operator/map"])}(this,function(e,t,n,r,o,i){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/",t(t.s=4)}([function(t,n){t.exports=e},function(e,t,n){"use strict";function r(e){if(0===e)return"0 Byte";var t=["Bytes","KB","MB","GB","TB","PB"],n=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,n)).toFixed(2))+" "+t[n]}n.d(t,"b",function(){return o}),t.c=r,n.d(t,"a",function(){return d});var o,i=n(0),a=(n.n(i),n(6)),s=(n.n(a),n(7)),u=(n.n(s),n(8)),p=(n.n(u),n(9)),l=(n.n(p),n(10));n.n(l);!function(e){e[e.Queue=0]="Queue",e[e.Uploading=1]="Uploading",e[e.Done=2]="Done",e[e.Canceled=3]="Canceled"}(o||(o={}));var d=function(){function e(){this.files=[],this.serviceEvents=new i.EventEmitter}return e.prototype.handleFiles=function(e){var t=this;(n=this.files).push.apply(n,[].map.call(e,function(e,n){var i={fileIndex:n,id:t.generateId(),name:e.name,size:e.size,type:e.type,form:new FormData,progress:{status:o.Queue,data:{percentage:0,speed:0,speedHuman:r(0)+"/s",startTime:null,endTime:null,eta:null,etaHuman:null}},lastModifiedDate:e.lastModifiedDate,sub:void 0,nativeFile:e};return n+=1,t.serviceEvents.emit({type:"addedToQueue",file:i}),i})),this.serviceEvents.emit({type:"allAddedToQueue"});var n},e.prototype.initInputEvents=function(e){var t=this;e.subscribe(function(e){switch(e.type){case"uploadFile":var n=t.files.findIndex(function(t){return t===e.file});-1!==n&&e.file&&(t.files[n].sub=t.uploadFile(e.file,e).subscribe(function(e){t.serviceEvents.emit(e)}));break;case"uploadAll":var r=void 0!==e.concurrency&&e.concurrency>0?e.concurrency:Number.POSITIVE_INFINITY,i=t.files.filter(function(e){return e.progress.status===o.Queue});if(!i.length)return;a.Observable.of.apply(a.Observable,i).mergeMap(function(n){return t.uploadFile(n,e)},r).subscribe(function(e){t.serviceEvents.emit(e)});break;case"cancel":var s=e.id||null;if(!s)return;var u=t.files.findIndex(function(e){return e.id===s});-1!==u&&(t.files[u].sub&&t.files[u].sub.unsubscribe(),t.serviceEvents.emit({type:"cancelled",file:t.files[u]}),t.files[u].progress.status=o.Canceled);break;case"cancelAll":t.files.forEach(function(e){e.sub&&e.sub.unsubscribe(),e.progress.status=o.Canceled,t.serviceEvents.emit({type:"cancelled",file:e})});break;case"remove":if(!e.id)return;var p=t.files.findIndex(function(t){return t.id===e.id});if(-1!==p){var l=t.files[p];t.files.splice(p,1),t.serviceEvents.emit({type:"removed",file:l})}break;case"removeAll":t.files.length&&(t.files=[],t.serviceEvents.emit({type:"removedAll"}))}})},e.prototype.uploadFile=function(e,t){var n=this;return new a.Observable(function(i){var a=t.url||"",s=t.method||"POST",u=t.data||{},p=t.headers||{},l=new FileReader,d=new XMLHttpRequest,c=(new Date).getTime(),f=e.progress.data&&e.progress.data.startTime||c,v=0,m=null;d.upload.addEventListener("progress",function(t){if(t.lengthComputable){var a=Math.round(100*t.loaded/t.total),s=(new Date).getTime()-c;v=Math.round(t.loaded/s*1e3),f=e.progress.data&&e.progress.data.startTime||(new Date).getTime(),m=Math.ceil((t.total-t.loaded)/v),e.progress={status:o.Uploading,data:{percentage:a,speed:v,speedHuman:r(v)+"/s",startTime:f,endTime:null,eta:m,etaHuman:n.secondsToHuman(m)}},i.next({type:"uploading",file:e})}},!1),d.upload.addEventListener("error",function(e){i.error(e),i.complete()}),d.onreadystatechange=function(){if(d.readyState===XMLHttpRequest.DONE){var t=Math.round(e.size/((new Date).getTime()-f)*1e3);e.progress={status:o.Done,data:{percentage:100,speed:t,speedHuman:r(t)+"/s",startTime:f,endTime:(new Date).getTime(),eta:m,etaHuman:n.secondsToHuman(m||0)}},e.responseStatus=d.status;try{e.response=JSON.parse(d.response)}catch(t){e.response=d.response}i.next({type:"done",file:e}),i.complete()}},d.open(s,a,!0),d.withCredentials=!!t.withCredentials;try{var b=e.nativeFile,g=n.files.findIndex(function(e){return e.nativeFile===b});n.files[g].progress.status===o.Canceled&&i.complete(),e.form.append(t.fieldName||"file",b,b.name),Object.keys(u).forEach(function(t){return e.form.append(t,u[t])}),Object.keys(p).forEach(function(e){return d.setRequestHeader(e,p[e])}),n.serviceEvents.emit({type:"start",file:e}),d.send(e.form)}catch(e){i.complete()}return function(){d.abort(),l.abort()}})},e.prototype.secondsToHuman=function(e){return new Date(1e3*e).toISOString().substr(11,8)},e.prototype.generateId=function(){return Math.random().toString(36).substring(7)},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var r=n(0),o=(n.n(r),n(1)),i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=function(){function e(e){this.elementRef=e,this.stopEvent=function(e){e.stopPropagation(),e.preventDefault()},this.upload=new o.a,this.uploadOutput=new r.EventEmitter}return e.prototype.ngOnInit=function(){var e=this;this.el=this.elementRef.nativeElement,this.upload.serviceEvents.subscribe(function(t){e.uploadOutput.emit(t)}),this.uploadInput instanceof r.EventEmitter&&this.upload.initInputEvents(this.uploadInput),this.el.addEventListener("drop",this.stopEvent,!1),this.el.addEventListener("dragenter",this.stopEvent,!1),this.el.addEventListener("dragover",this.stopEvent,!1)},e.prototype.ngOnDestroy=function(){this.uploadInput&&this.uploadInput.unsubscribe()},e.prototype.onDrop=function(e){e.stopPropagation(),e.preventDefault();var t={type:"drop"};this.uploadOutput.emit(t),this.upload.handleFiles(e.dataTransfer.files)},e.prototype.onDragOver=function(e){if(e){var t={type:"dragOver"};this.uploadOutput.emit(t)}},e.prototype.onDragLeave=function(e){if(e){var t={type:"dragOut"};this.uploadOutput.emit(t)}},i([Object(r.Input)(),a("design:type",r.EventEmitter)],e.prototype,"uploadInput",void 0),i([Object(r.Output)(),a("design:type",r.EventEmitter)],e.prototype,"uploadOutput",void 0),i([Object(r.HostListener)("drop",["$event"]),a("design:type",Function),a("design:paramtypes",[Object]),a("design:returntype",void 0)],e.prototype,"onDrop",null),i([Object(r.HostListener)("dragover",["$event"]),a("design:type",Function),a("design:paramtypes",[Event]),a("design:returntype",void 0)],e.prototype,"onDragOver",null),i([Object(r.HostListener)("dragleave",["$event"]),a("design:type",Function),a("design:paramtypes",[Event]),a("design:returntype",void 0)],e.prototype,"onDragLeave",null),e=i([Object(r.Directive)({selector:"[ngFileDrop]"}),a("design:paramtypes",[r.ElementRef])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var r=n(0),o=(n.n(r),n(1)),i=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=function(){function e(e){var t=this;this.elementRef=e,this.fileListener=function(){t.el.files&&t.upload.handleFiles(t.el.files)},this.upload=new o.a,this.uploadOutput=new r.EventEmitter}return e.prototype.ngOnInit=function(){var e=this;this.el=this.elementRef.nativeElement,this.el.addEventListener("change",this.fileListener,!1),this.upload.serviceEvents.subscribe(function(t){e.uploadOutput.emit(t)}),this.uploadInput instanceof r.EventEmitter&&this.upload.initInputEvents(this.uploadInput)},e.prototype.ngOnDestroy=function(){this.el.removeEventListener("change",this.fileListener,!1),this.uploadInput&&this.uploadInput.unsubscribe()},i([Object(r.Input)(),a("design:type",r.EventEmitter)],e.prototype,"uploadInput",void 0),i([Object(r.Output)(),a("design:type",r.EventEmitter)],e.prototype,"uploadOutput",void 0),e=i([Object(r.Directive)({selector:"[ngFileSelect]"}),a("design:paramtypes",[r.ElementRef])],e)}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5);n.d(t,"NgUploaderModule",function(){return r.a});var o=n(1);n.d(t,"UploadStatus",function(){return o.b}),n.d(t,"humanizeBytes",function(){return o.c}),n.d(t,"NgUploaderService",function(){return o.a});var i=n(3);n.d(t,"NgFileSelectDirective",function(){return i.a});var a=n(2);n.d(t,"NgFileDropDirective",function(){return a.a})},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var r=n(0),o=(n.n(r),n(2)),i=n(3),a=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(i<3?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},s=function(){function e(){}return e=a([Object(r.NgModule)({declarations:[i.a,o.a],exports:[i.a,o.a]})],e)}()},function(e,n){e.exports=t},function(e,t){e.exports=n},function(e,t){e.exports=r},function(e,t){e.exports=o},function(e,t){e.exports=i}])});
//# sourceMappingURL=ngx-uploader.umd.js.map